"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[3417],{6574(e,s,n){n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"api-reference/cloud-functions","title":"Cloud Functions","description":"DocWeb uses Firebase Cloud Functions (Node.js 20) for its backend logic.","source":"@site/docs/api-reference/cloud-functions.md","sourceDirName":"api-reference","slug":"/api-reference/cloud-functions","permalink":"/docs/docs/api-reference/cloud-functions","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/api-reference/cloud-functions.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"API Reference","permalink":"/docs/docs/api-reference/"},"next":{"title":"Firestore Schema","permalink":"/docs/docs/api-reference/firestore-schema"}}');var r=n(4848),d=n(8453);const c={},t="Cloud Functions",l={},a=[{value:"discoverSitemaps",id:"discoversitemaps",level:2},{value:"Actions",id:"actions",level:3},{value:"Request (discoverAndSave)",id:"request-discoverandsave",level:3},{value:"Response",id:"response",level:3},{value:"scrapeNodes",id:"scrapenodes",level:2},{value:"Actions",id:"actions-1",level:3},{value:"Request",id:"request",level:3},{value:"Response",id:"response-1",level:3},{value:"chat",id:"chat",level:2},{value:"Features",id:"features",level:3},{value:"Request",id:"request-1",level:3},{value:"Response",id:"response-2",level:3},{value:"generateEmbeddings",id:"generateembeddings",level:2},{value:"Actions",id:"actions-2",level:3},{value:"Embedding Process",id:"embedding-process",level:3},{value:"Session Management",id:"session-management",level:2},{value:"getSessions",id:"getsessions",level:3},{value:"deleteSession",id:"deletesession",level:3},{value:"updateSessionAccess",id:"updatesessionaccess",level:3},{value:"Credits &amp; Billing",id:"credits--billing",level:2},{value:"getUserCredits",id:"getusercredits",level:3},{value:"checkCredits",id:"checkcredits",level:3},{value:"deductCredits",id:"deductcredits",level:3},{value:"createCheckoutSession",id:"createcheckoutsession",level:3},{value:"createCustomerPortal",id:"createcustomerportal",level:3},{value:"getSubscriptionStatus",id:"getsubscriptionstatus",level:3},{value:"stripeWebhook",id:"stripewebhook",level:3},{value:"Cache Admin",id:"cache-admin",level:2},{value:"getCachedDomains",id:"getcacheddomains",level:3},{value:"getCachedPages",id:"getcachedpages",level:3},{value:"deleteCachedDomain",id:"deletecacheddomain",level:3},{value:"deleteCachedPage",id:"deletecachedpage",level:3}];function o(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"cloud-functions",children:"Cloud Functions"})}),"\n",(0,r.jsx)(s.p,{children:"DocWeb uses Firebase Cloud Functions (Node.js 20) for its backend logic."}),"\n",(0,r.jsx)(s.h2,{id:"discoversitemaps",children:"discoverSitemaps"}),"\n",(0,r.jsxs)(s.p,{children:["Handles URL discovery using the ",(0,r.jsx)(s.a,{href:"/docs/docs/core-concepts/waterfall-discovery",children:"Waterfall Discovery"})," algorithm."]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Memory"}),": 1 GiB | ",(0,r.jsx)(s.strong,{children:"Timeout"}),": 300s"]}),"\n",(0,r.jsx)(s.h3,{id:"actions",children:"Actions"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Action"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"findSitemaps"})}),(0,r.jsx)(s.td,{children:"Discover sitemap URLs from robots.txt"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"processSitemaps"})}),(0,r.jsx)(s.td,{children:"Parse sitemap XML files"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"crawlSidebar"})}),(0,r.jsx)(s.td,{children:"Navigation link extraction"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"discoverAndSave"})}),(0,r.jsx)(s.td,{children:"Full waterfall discovery + save"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"cleanupSession"})}),(0,r.jsx)(s.td,{children:"Archive previous session data"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"updateStatus"})}),(0,r.jsx)(s.td,{children:"Update URL statuses"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"request-discoverandsave",children:"Request (discoverAndSave)"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'{\n    url: string;\n    appId: string;\n    action: "discoverAndSave";\n    searchId?: string;\n    depth?: number;\n}\n'})}),"\n",(0,r.jsx)(s.h3,{id:"response",children:"Response"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'{\n    success: boolean;\n    urlCount: number;\n    savedCount: number;\n    sessionId: string;\n    rootUrl: string;\n    clusters: ClusterStats[];\n    source: "waterfall" | "cache";\n    discoveryStats: {\n        sitemapUrls: number;\n        navigationUrls: number;\n        navScrapeUrls: number;\n        totalUnique: number;\n        sources: Record<string, number>;\n    };\n    fromCache: boolean;\n    cacheAge?: number;\n}\n'})}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"scrapenodes",children:"scrapeNodes"}),"\n",(0,r.jsx)(s.p,{children:"Handles content extraction and Markdown conversion."}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Memory"}),": 512 MiB | ",(0,r.jsx)(s.strong,{children:"Timeout"}),": 120s"]}),"\n",(0,r.jsx)(s.h3,{id:"actions-1",children:"Actions"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Action"}),(0,r.jsx)(s.th,{children:"Description"}),(0,r.jsx)(s.th,{children:"Max Nodes"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"autoScrape"})}),(0,r.jsx)(s.td,{children:"Scrape structural nodes after discovery"}),(0,r.jsx)(s.td,{children:"10"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"scrapeCluster"})}),(0,r.jsx)(s.td,{children:"Scrape all nodes in a cluster"}),(0,r.jsx)(s.td,{children:"20"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"scrapeNodes"})}),(0,r.jsx)(s.td,{children:"Scrape specific node IDs"}),(0,r.jsx)(s.td,{children:"Unlimited"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"request",children:"Request"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'{\n    action: "autoScrape" | "scrapeCluster" | "scrapeNodes";\n    appId: string;\n    searchId?: string;\n    clusterId?: string;\n    docIds?: string[];\n    maxNodes?: number;\n}\n'})}),"\n",(0,r.jsx)(s.h3,{id:"response-1",children:"Response"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:"{\n    success: boolean;\n    scraped: number;\n    failed: number;\n    skipped: number;\n    results: ScrapeResult[];\n}\n"})}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"chat",children:"chat"}),"\n",(0,r.jsxs)(s.p,{children:["Powers the ",(0,r.jsx)(s.a,{href:"/docs/docs/features/rag-chatbot",children:"Dex AI chatbot"})," with RAG-based responses."]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Memory"}),": 1 GiB | ",(0,r.jsx)(s.strong,{children:"Timeout"}),": 120s"]}),"\n",(0,r.jsx)(s.h3,{id:"features",children:"Features"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Greeting detection with smart topic suggestions"}),"\n",(0,r.jsx)(s.li,{children:"Hybrid search (vector + keyword)"}),"\n",(0,r.jsx)(s.li,{children:"Just-in-Time (JIT) scraping for unscraped pages"}),"\n",(0,r.jsx)(s.li,{children:"Site map awareness"}),"\n",(0,r.jsx)(s.li,{children:"Source citations with relevance scores"}),"\n",(0,r.jsx)(s.li,{children:"Thinking steps display"}),"\n",(0,r.jsx)(s.li,{children:"Related pages suggestions"}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"request-1",children:"Request"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:"{\n    message: string;\n    appId: string;\n    searchId: string;\n    conversationId?: string;\n    siteName?: string;\n}\n"})}),"\n",(0,r.jsx)(s.h3,{id:"response-2",children:"Response"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:"{\n    success: boolean;\n    response: string;\n    conversationId: string;\n    sources: SourceCitation[];\n    codeBlocks: CodeBlock[];\n    messageId: string;\n    sourceNodeIds: string[];     // For graph highlighting\n    isGreeting: boolean;\n    thinkingSteps: string[];     // Dex's reasoning process\n    suggestedTopics?: SuggestedTopic[];\n    relatedPages?: RelatedPage[];\n}\n"})}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"generateembeddings",children:"generateEmbeddings"}),"\n",(0,r.jsx)(s.p,{children:"Generates vector embeddings for semantic search."}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Memory"}),": 1 GiB | ",(0,r.jsx)(s.strong,{children:"Timeout"}),": 540s"]}),"\n",(0,r.jsx)(s.h3,{id:"actions-2",children:"Actions"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Action"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"generateForSearch"})}),(0,r.jsx)(s.td,{children:"Generate embeddings for a search session"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"generateForDoc"})}),(0,r.jsx)(s.td,{children:"Generate embedding for single document"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"regenerateAll"})}),(0,r.jsx)(s.td,{children:"Regenerate all embeddings for session"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"embedding-process",children:"Embedding Process"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"Combine title + description + mainContent"}),"\n",(0,r.jsx)(s.li,{children:"Chunk text (4,000 chars, 400 overlap)"}),"\n",(0,r.jsx)(s.li,{children:"Generate embedding per chunk via Gemini text-embedding-004"}),"\n",(0,r.jsx)(s.li,{children:"Store in global collection (deduplicated by URL hash)"}),"\n",(0,r.jsx)(s.li,{children:"Track searchIds for cross-session sharing"}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"session-management",children:"Session Management"}),"\n",(0,r.jsx)(s.h3,{id:"getsessions",children:"getSessions"}),"\n",(0,r.jsx)(s.p,{children:"Returns all saved sessions for the authenticated user."}),"\n",(0,r.jsx)(s.h3,{id:"deletesession",children:"deleteSession"}),"\n",(0,r.jsx)(s.p,{children:"Deletes a session and cascades to URLs/conversations."}),"\n",(0,r.jsx)(s.h3,{id:"updatesessionaccess",children:"updateSessionAccess"}),"\n",(0,r.jsxs)(s.p,{children:["Updates ",(0,r.jsx)(s.code,{children:"lastAccessedAt"})," timestamp when user switches sessions."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"credits--billing",children:"Credits & Billing"}),"\n",(0,r.jsx)(s.h3,{id:"getusercredits",children:"getUserCredits"}),"\n",(0,r.jsx)(s.p,{children:"Returns user's credit profile including tier, remaining credits, and reset time."}),"\n",(0,r.jsx)(s.h3,{id:"checkcredits",children:"checkCredits"}),"\n",(0,r.jsx)(s.p,{children:"Verifies user has sufficient credits for an action."}),"\n",(0,r.jsx)(s.h3,{id:"deductcredits",children:"deductCredits"}),"\n",(0,r.jsx)(s.p,{children:"Deducts credits after successful action."}),"\n",(0,r.jsx)(s.h3,{id:"createcheckoutsession",children:"createCheckoutSession"}),"\n",(0,r.jsx)(s.p,{children:"Creates Stripe checkout session for subscription upgrade."}),"\n",(0,r.jsx)(s.h3,{id:"createcustomerportal",children:"createCustomerPortal"}),"\n",(0,r.jsx)(s.p,{children:"Creates Stripe customer portal link for subscription management."}),"\n",(0,r.jsx)(s.h3,{id:"getsubscriptionstatus",children:"getSubscriptionStatus"}),"\n",(0,r.jsx)(s.p,{children:"Returns current subscription status."}),"\n",(0,r.jsx)(s.h3,{id:"stripewebhook",children:"stripeWebhook"}),"\n",(0,r.jsx)(s.p,{children:"Handles Stripe webhook events:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"checkout.session.completed"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"customer.subscription.updated"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"customer.subscription.deleted"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"invoice.payment_succeeded"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"invoice.payment_failed"})}),"\n"]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"cache-admin",children:"Cache Admin"}),"\n",(0,r.jsx)(s.h3,{id:"getcacheddomains",children:"getCachedDomains"}),"\n",(0,r.jsx)(s.p,{children:"Lists all cached domains with metadata."}),"\n",(0,r.jsx)(s.h3,{id:"getcachedpages",children:"getCachedPages"}),"\n",(0,r.jsx)(s.p,{children:"Lists cached pages for a specific domain."}),"\n",(0,r.jsx)(s.h3,{id:"deletecacheddomain",children:"deleteCachedDomain"}),"\n",(0,r.jsx)(s.p,{children:"Clears all cache for a domain."}),"\n",(0,r.jsx)(s.h3,{id:"deletecachedpage",children:"deleteCachedPage"}),"\n",(0,r.jsx)(s.p,{children:"Clears cache for a single page URL."})]})}function h(e={}){const{wrapper:s}={...(0,d.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},8453(e,s,n){n.d(s,{R:()=>c,x:()=>t});var i=n(6540);const r={},d=i.createContext(r);function c(e){const s=i.useContext(d);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),i.createElement(d.Provider,{value:s},e.children)}}}]);