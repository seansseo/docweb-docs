"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[4587],{8453(e,s,r){r.d(s,{R:()=>c,x:()=>a});var n=r(6540);const t={},i=n.createContext(t);function c(e){const s=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),n.createElement(i.Provider,{value:s},e.children)}},9131(e,s,r){r.r(s),r.d(s,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"core-concepts/waterfall-discovery","title":"Waterfall Discovery","description":"The app doesn\'t just \\"scrape\\" a site; it understands it through a multi-stage process called Waterfall Discovery.","source":"@site/docs/core-concepts/waterfall-discovery.md","sourceDirName":"core-concepts","slug":"/core-concepts/waterfall-discovery","permalink":"/docs/docs/core-concepts/waterfall-discovery","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/core-concepts/waterfall-discovery.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Architecture","permalink":"/docs/docs/core-concepts/architecture"},"next":{"title":"URL Classification","permalink":"/docs/docs/core-concepts/url-classification"}}');var t=r(4848),i=r(8453);const c={},a="Waterfall Discovery",l={},d=[{value:"Discovery Stages",id:"discovery-stages",level:2},{value:"Configuration Constants",id:"configuration-constants",level:2},{value:"Nav-Scrape (Priority 0)",id:"nav-scrape-priority-0",level:2},{value:"Sitemap Discovery (Stage 1)",id:"sitemap-discovery-stage-1",level:2},{value:"Navigation Crawl (Stage 2)",id:"navigation-crawl-stage-2",level:2},{value:"Deep Dives",id:"deep-dives",level:2}];function o(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"waterfall-discovery",children:"Waterfall Discovery"})}),"\n",(0,t.jsxs)(s.p,{children:['The app doesn\'t just "scrape" a site; it understands it through a multi-stage process called ',(0,t.jsx)(s.strong,{children:"Waterfall Discovery"}),"."]}),"\n",(0,t.jsx)(s.h2,{id:"discovery-stages",children:"Discovery Stages"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Priority 0: Nav-Scrape                                   \u2502\n\u2502 Extract structural links from nav/aside/header elements  \u2502\n\u2502 Captures link text for titles                           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Stage 1: Sitemap Discovery                              \u2502\n\u2502 1. Fetch robots.txt                                     \u2502\n\u2502 2. Parse Sitemap: declarations                          \u2502\n\u2502 3. Recursively process sitemap indexes (max depth 5)    \u2502\n\u2502 4. Handle gzip-compressed sitemaps (.xml.gz)            \u2502\n\u2502 5. Extract all <url><loc> entries                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Stage 2: Navigation Crawl (if sitemaps < 500 URLs)      \u2502\n\u2502 1. BFS crawl from base URL (max depth 3)                \u2502\n\u2502 2. Extract links from header, footer, nav, main         \u2502\n\u2502 3. Track source of each discovered URL                  \u2502\n\u2502 4. Respect robots.txt crawl-delay                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Stage 3: Merge & Classify                               \u2502\n\u2502 1. Deduplicate URLs                                     \u2502\n\u2502 2. Extract path segments                                \u2502\n\u2502 3. Assign overlapping clusters                          \u2502\n\u2502 4. Calculate priority scores                            \u2502\n\u2502 5. Detect non-English URLs (skip scraping)              \u2502\n\u2502 6. Save to Firestore                                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(s.h2,{id:"configuration-constants",children:"Configuration Constants"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Parameter"}),(0,t.jsx)(s.th,{children:"Value"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"MAX_CRAWL_DEPTH"})}),(0,t.jsx)(s.td,{children:"3"}),(0,t.jsx)(s.td,{children:"Maximum BFS depth for navigation crawl"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"MAX_SITEMAP_DEPTH"})}),(0,t.jsx)(s.td,{children:"5"}),(0,t.jsx)(s.td,{children:"Maximum recursion for sitemap indexes"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"REQUEST_TIMEOUT"})}),(0,t.jsx)(s.td,{children:"15,000 ms"}),(0,t.jsx)(s.td,{children:"HTTP request timeout"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"MAX_RETRIES"})}),(0,t.jsx)(s.td,{children:"3"}),(0,t.jsx)(s.td,{children:"Retry count for failed requests"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"CHUNK_SIZE"})}),(0,t.jsx)(s.td,{children:"50"}),(0,t.jsx)(s.td,{children:"URLs processed per batch"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"MAX_URLS_PER_SOURCE"})}),(0,t.jsx)(s.td,{children:"10,000"}),(0,t.jsx)(s.td,{children:"Cap per discovery source"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"SITEMAP_SUFFICIENT_THRESHOLD"})}),(0,t.jsx)(s.td,{children:"500"}),(0,t.jsx)(s.td,{children:"Skip nav crawl if sitemaps return this many URLs"})]})]})]}),"\n",(0,t.jsx)(s.h2,{id:"nav-scrape-priority-0",children:"Nav-Scrape (Priority 0)"}),"\n",(0,t.jsxs)(s.p,{children:["Before sitemap discovery, DocWeb performs a ",(0,t.jsx)(s.strong,{children:"Nav-Scrape"})," to capture the site's intended navigation structure:"]}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Fetch the root URL"}),"\n",(0,t.jsxs)(s.li,{children:["Extract all links from ",(0,t.jsx)(s.code,{children:"<nav>"}),", ",(0,t.jsx)(s.code,{children:"<aside>"}),", and ",(0,t.jsx)(s.code,{children:"<header>"})," elements"]}),"\n",(0,t.jsx)(s.li,{children:"Capture link text for use as page titles"}),"\n",(0,t.jsxs)(s.li,{children:["Mark these URLs as ",(0,t.jsx)(s.strong,{children:"structural nodes"})," with ",(0,t.jsx)(s.code,{children:"importanceScore: 1.0"})]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"This ensures that even sites with poor sitemaps have meaningful structure."}),"\n",(0,t.jsx)(s.h2,{id:"sitemap-discovery-stage-1",children:"Sitemap Discovery (Stage 1)"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["Fetch ",(0,t.jsx)(s.code,{children:"robots.txt"})," from the root domain"]}),"\n",(0,t.jsxs)(s.li,{children:["Parse all ",(0,t.jsx)(s.code,{children:"Sitemap:"})," declarations"]}),"\n",(0,t.jsxs)(s.li,{children:["For each sitemap URL:","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["If it's a sitemap index (",(0,t.jsx)(s.code,{children:".xml"})," with ",(0,t.jsx)(s.code,{children:"<sitemapindex>"}),"), recursively process child sitemaps"]}),"\n",(0,t.jsxs)(s.li,{children:["If it's gzip-compressed (",(0,t.jsx)(s.code,{children:".xml.gz"}),"), decompress before parsing"]}),"\n",(0,t.jsxs)(s.li,{children:["Extract all ",(0,t.jsx)(s.code,{children:"<url><loc>"})," entries"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["Track discovery source as ",(0,t.jsx)(s.code,{children:'"sitemap"'})," or ",(0,t.jsx)(s.code,{children:'"sitemap-index"'})]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"navigation-crawl-stage-2",children:"Navigation Crawl (Stage 2)"}),"\n",(0,t.jsx)(s.p,{children:"If sitemaps yield fewer than 500 URLs, DocWeb supplements with a BFS navigation crawl:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Start from the base URL"}),"\n",(0,t.jsx)(s.li,{children:"Extract links from header, footer, nav, and main content areas"}),"\n",(0,t.jsxs)(s.li,{children:["Follow internal links up to ",(0,t.jsx)(s.code,{children:"MAX_CRAWL_DEPTH"})," (3 levels)"]}),"\n",(0,t.jsxs)(s.li,{children:["Respect ",(0,t.jsx)(s.code,{children:"crawl-delay"})," directives from robots.txt"]}),"\n",(0,t.jsxs)(s.li,{children:["Track discovery source (e.g., ",(0,t.jsx)(s.code,{children:'"navigation"'}),", ",(0,t.jsx)(s.code,{children:'"footer"'}),", ",(0,t.jsx)(s.code,{children:'"content-link"'}),")"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"deep-dives",children:"Deep Dives"}),"\n",(0,t.jsxs)(s.p,{children:["You can trigger an on-demand ",(0,t.jsx)(s.strong,{children:"Deep Dive"})," on a cluster to:"]}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Scrape all pages in that cluster"}),"\n",(0,t.jsx)(s.li,{children:"Generate embeddings for RAG chat"}),"\n",(0,t.jsx)(s.li,{children:"Enable semantic search within that topic area"}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["Learn how we categorize these links in ",(0,t.jsx)(s.a,{href:"/docs/docs/core-concepts/url-classification",children:"URL Classification"}),"."]})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}}}]);