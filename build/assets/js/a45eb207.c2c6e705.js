"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[2305],{6980(e,n,s){s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"api-reference/firestore-schema","title":"Firestore Schema","description":"DocWeb stores its data in Google Cloud Firestore with the following collections and schemas.","source":"@site/docs/api-reference/firestore-schema.md","sourceDirName":"api-reference","slug":"/api-reference/firestore-schema","permalink":"/docs/api-reference/firestore-schema","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/api-reference/firestore-schema.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Cloud Functions","permalink":"/docs/api-reference/cloud-functions"},"next":{"title":"Frontend Hooks","permalink":"/docs/api-reference/frontend-hooks"}}');var i=s(4848),t=s(8453);const a={},c="Firestore Schema",o={},d=[{value:"DiscoveredUrlDoc",id:"discoveredurldoc",level:2},{value:"SavedSession",id:"savedsession",level:2},{value:"GlobalEmbeddingDocument",id:"globalembeddingdocument",level:2},{value:"DomainCache",id:"domaincache",level:2},{value:"PageCache",id:"pagecache",level:2},{value:"UserCreditsProfile",id:"usercreditsprofile",level:2},{value:"Collection Hierarchy",id:"collection-hierarchy",level:2},{value:"Indexes",id:"indexes",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",p:"p",pre:"pre",strong:"strong",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"firestore-schema",children:"Firestore Schema"})}),"\n",(0,i.jsx)(n.p,{children:"DocWeb stores its data in Google Cloud Firestore with the following collections and schemas."}),"\n",(0,i.jsx)(n.h2,{id:"discoveredurldoc",children:"DiscoveredUrlDoc"}),"\n",(0,i.jsx)(n.p,{children:"Stores discovered URLs with metadata, clustering, and scraped content."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Collection"}),": ",(0,i.jsx)(n.code,{children:"artifacts/{userId}/public/data/urls/{docId}"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'interface DiscoveredUrlDoc {\n    // Core identification\n    url: string;                          // Full URL\n    docId: string;                        // Base64url-encoded unique ID (max 128 chars)\n\n    // Discovery metadata\n    discoverySource: "sitemap" | "sitemap-index" | "navigation" |\n                     "content-link" | "footer" | "header";\n    foundAt?: string;                     // Parent URL (for navigation sources)\n\n    // Nav-Scrape metadata (structural anchor nodes)\n    isStructuralNode: boolean;            // Found in nav/aside/header\n    importanceScore: number;              // 1.0 for anchor nodes, 0.5 default\n\n    // Clustering (OVERLAPPING - URLs can belong to multiple clusters)\n    clusterIds: string[];                 // e.g., ["/features", "/api"]\n    clusterLabels: string[];              // e.g., ["Features", "API"]\n    primaryClusterId: string;             // Main cluster (first path segment)\n    primaryClusterLabel: string;          // Main cluster label\n\n    // Hierarchy (for force-graph links)\n    path_segments: string[];              // e.g., ["docs", "api", "users"]\n    depth: number;                        // Path depth\n    parentPath: string;                   // e.g., "/docs/api"\n    parentId: string | null;              // docId of parent URL\n\n    // Priority\n    priority: "critical" | "high" | "medium" | "low";\n    priorityScore: number;                // 0-100 (lower = more important)\n    isDocumentation: boolean;\n\n    // Classification (Inferred Semantic Framework)\n    contentCategory: "primary" | "support" | "utility" | "unknown";\n\n    // Session tracking\n    sessionId: string;\n    searchId: string;\n    rootUrl: string;\n    status: "discovered" | "scraping" | "completed" | "error" | "archived";\n\n    // Language detection\n    language: string;                     // e.g., "en", "fr", "zh-cn"\n\n    // Scraped content\n    title?: string;\n    description?: string;                 // First 500 chars\n    mainContent?: string;                 // Markdown (max 50KB)\n    scrapingStatus: "pending" | "scraping" | "complete" | "failed" | "skipped";\n    lastScraped?: Date;\n    scrapeError?: string;\n\n    // Timestamps\n    discovered_at: Date;\n    updated_at: Date;\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"savedsession",children:"SavedSession"}),"\n",(0,i.jsx)(n.p,{children:"Stores user's saved discovery sessions."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Collection"}),": ",(0,i.jsx)(n.code,{children:"artifacts/{userId}/public/data/sessions/{sessionId}"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'interface SavedSession {\n    sessionId: string;                    // Same as searchId\n    userId: string;\n    domain: string;                       // e.g., "docs.stripe.com"\n    rootUrl: string;\n    title: string;\n    urlCount: number;\n    scrapedCount: number;\n    messageCount: number;\n    createdAt: Date;\n    updatedAt: Date;\n    lastAccessedAt: Date;\n    status: "active" | "archived";\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"globalembeddingdocument",children:"GlobalEmbeddingDocument"}),"\n",(0,i.jsx)(n.p,{children:"Stores vector embeddings for semantic search (shared across all users)."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Collection"}),": ",(0,i.jsx)(n.code,{children:"artifacts/global/embeddings/{urlHash}_chunk{N}"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"interface GlobalEmbeddingDocument {\n    urlHash: string;                      // SHA256 hash (16 chars)\n    url: string;\n    domain: string;                       // For domain-scoped queries\n    chunkIndex: number;\n    chunkText: string;                    // First 2000 chars of chunk\n    embedding: number[];                  // 768-dim vector\n    title: string;\n    description: string;\n    searchIds: string[];                  // Sessions referencing this\n    contentHash: string;                  // MD5 of content (12 chars)\n    createdAt: Timestamp;\n    updatedAt: Timestamp;\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"domaincache",children:"DomainCache"}),"\n",(0,i.jsx)(n.p,{children:"Caches discovered URLs for entire domains."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Collection"}),": ",(0,i.jsx)(n.code,{children:"artifacts/global/domainCache/{domainHash}"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'interface DomainCache {\n    domain: string;\n    urls: string[];\n    clusters: ClusterStats[];\n    discoveryStats: DiscoveryStats;\n    source: "waterfall" | "cache";\n    discoveredAt: Timestamp;\n    expiresAt: Timestamp;                 // 24-hour TTL\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"pagecache",children:"PageCache"}),"\n",(0,i.jsx)(n.p,{children:"Caches scraped page content."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Collection"}),": ",(0,i.jsx)(n.code,{children:"artifacts/global/pageCache/{urlHash}"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"interface PageCache {\n    url: string;\n    domain: string;\n    title: string;\n    description: string;\n    mainContent: string;\n    contentHash: string;                  // MD5 (12 chars)\n    scrapedAt: Timestamp;\n    expiresAt: Timestamp;                 // 24-hour TTL\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"usercreditsprofile",children:"UserCreditsProfile"}),"\n",(0,i.jsx)(n.p,{children:"Stores user account and billing information."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Collection"}),": ",(0,i.jsx)(n.code,{children:"users/{userId}"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'interface UserCreditsProfile {\n    email: string;\n    tier: "free" | "pro" | "max";\n    creditsUsedToday: number;\n    creditsRemaining: number;\n    creditsPerDay: number;\n    maxSessions: number;\n    nextResetTime: string;                // ISO string (midnight UTC)\n    totalDiscoveries: number;\n    totalChatMessages: number;\n    stripeCustomerId?: string;\n    subscriptionId?: string;\n    subscriptionStatus?: "active" | "canceled" | "past_due";\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"collection-hierarchy",children:"Collection Hierarchy"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"firestore/\n\u251c\u2500\u2500 artifacts/\n\u2502   \u251c\u2500\u2500 {userId}/\n\u2502   \u2502   \u2514\u2500\u2500 public/\n\u2502   \u2502       \u2514\u2500\u2500 data/\n\u2502   \u2502           \u251c\u2500\u2500 urls/{docId}          # DiscoveredUrlDoc\n\u2502   \u2502           \u2514\u2500\u2500 sessions/{sessionId}   # SavedSession\n\u2502   \u2514\u2500\u2500 global/\n\u2502       \u251c\u2500\u2500 domainCache/{domainHash}       # DomainCache\n\u2502       \u251c\u2500\u2500 pageCache/{urlHash}            # PageCache\n\u2502       \u2514\u2500\u2500 embeddings/{urlHash}_chunk{N}  # GlobalEmbeddingDocument\n\u2514\u2500\u2500 users/\n    \u2514\u2500\u2500 {userId}                           # UserCreditsProfile\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"indexes",children:"Indexes"}),"\n",(0,i.jsxs)(n.p,{children:["Required composite indexes (",(0,i.jsx)(n.code,{children:"firestore.indexes.json"}),"):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "indexes": [\n        {\n            "collectionGroup": "pageCache",\n            "fields": [\n                { "fieldPath": "domain", "order": "ASCENDING" },\n                { "fieldPath": "scrapedAt", "order": "DESCENDING" }\n            ]\n        }\n    ]\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453(e,n,s){s.d(n,{R:()=>a,x:()=>c});var r=s(6540);const i={},t=r.createContext(i);function a(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);